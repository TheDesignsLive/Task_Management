<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assign By Me</title>

<style>
  /* ===== PREVENT FULL PAGE SCROLL ===== */
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;   /* Prevent page scroll */
    font-family: Arial, sans-serif;
    background-color: #3C3A3A;
  }

  .layout {
    display: flex;
    height: calc(100% - 60px); /* Adjust based on navbar height */
  }

  .sidebar-container {
    width: 55px;
  }

  .main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* ===== HEADERS ===== */
  .sub-header {
    display: flex;
    background-color: #CDF4F4;
    padding: 10px;
    gap: 10px;
    align-items: center;
    font-weight: bold;
    color: #333;
  }

  /* Header Columns - Flex Ratios */
  .col-title { flex: 2; padding-left: 10px; }
  .col-desc { flex: 3; }
  .col-assign { flex: 1.5; text-align: center; }
  .col-date { flex: 1; text-align: right; padding-right: 10px; }

  /* ===== CONTENT WRAPPER ===== */
  .content-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* ===== TASK LIST SECTION ===== */
  .task-list-container {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
  }

  /* Task Item Card */
  .task-item {
    display: flex;
    align-items: center;
    padding: 12px 10px;
    margin: 6px 0;
    background-color: #444;
    color: #fff;
    border-radius: 4px;
    gap: 10px;
  }

  .task-item.completed-task {
    opacity: 0.6;
    background-color: #2E2D2D;
  }

  .task-text {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  /* ===== COMPLETED SECTION ===== */
  .completed-header {
    margin: 0 10px;
    border-radius: 100px;
    background-color: #0F8989;
    padding: 8px 20px;
    font-weight: bold;
    color: white;
    margin-top: 10px;
  }

  .completed-section {
    height: 150px;
    overflow-y: auto;
    padding: 10px;
    background-color: #2E2D2D;
    color: white;
  }

</style>
</head>

<body>
<%- include('navbar') %>

<div class="layout">

  <div class="sidebar-container">
    <% if (show_sidebar === 'sidebar') { %>
      <%- include('sidebar') %>
    <% } else if (show_sidebar === 'Usersidebar') { %>
      <%- include('user_sidebar') %>
    <% } %>
  </div>

  <div class="main-content">

    <div class="sub-header">
      <div class="col-title">Title</div>
      <div class="col-desc">Description</div>
      <div class="col-assign">Assigned To</div>
      <div class="col-date">Date</div>
    </div>

    <div class="content-wrapper">

      <div class="task-list-container">
        <% if (openTasks.length > 0) { %>
          <% openTasks.forEach(task => { %>
            <div class="task-item">
              <div class="col-title task-text" title="<%= task.title %>"><%= task.title %></div>
              <div class="col-desc task-text" title="<%= task.description %>"><%= task.description %></div>
              <div class="col-assign task-text"><%= task.assigned_to %></div>
              <div class="col-date date-display" data-date="<%= task.due_date %>"></div>
            </div>
          <% }) %>
        <% } else { %>
          <div style="color: #aaa; padding: 20px; text-align: center;">No open tasks assigned by you.</div>
        <% } %>
      </div>

      <div class="completed-header">Completed Tasks</div>
      <div class="completed-section">
        <% if (completedTasks.length > 0) { %>
          <% completedTasks.forEach(task => { %>
            <div class="task-item completed-task">
              <div class="col-title task-text" title="<%= task.title %>"><%= task.title %></div>
              <div class="col-desc task-text" title="<%= task.description %>"><%= task.description %></div>
              <div class="col-assign task-text"><%= task.assigned_to %></div>
              <div class="col-date date-display" data-date="<%= task.due_date %>"></div>
            </div>
          <% }) %>
        <% } else { %>
          <div style="color: #888; padding: 10px; text-align: center;">No completed tasks.</div>
        <% } %>
      </div>

    </div>

  </div>
</div>

<script>
// ===== DATE FORMAT FUNCTION =====
function formatDate(dateStr) {
  if (!dateStr || dateStr === 'null') return '';

  const today = new Date();
  const tomorrow = new Date();
  tomorrow.setDate(today.getDate() + 1);

  const taskDate = new Date(dateStr);

  today.setHours(0,0,0,0);
  tomorrow.setHours(0,0,0,0);
  taskDate.setHours(0,0,0,0);

  if (taskDate.getTime() === today.getTime()) return "Today";
  else if (taskDate.getTime() === tomorrow.getTime()) return "Tom";
  else return taskDate.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
}

// ===== APPLY DATE FORMATTING ON LOAD =====
document.addEventListener('DOMContentLoaded', () => {
  const dateElements = document.querySelectorAll('.date-display');
  dateElements.forEach(el => {
    const rawDate = el.getAttribute('data-date');
    el.innerText = formatDate(rawDate);
  });
});
</script>

</body>
</html>