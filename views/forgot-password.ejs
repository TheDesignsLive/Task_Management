<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forgot Password</title>
<style>
body {
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background: linear-gradient(135deg,#0f766e,#14b8a6);
    font-family: Arial, Helvetica, sans-serif;
}

.container{
    width:380px;
    background:#fff;
    border-radius:12px;
    padding:25px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

.input-group {
    margin-bottom:15px;
}

.input-group input {
    width:100%;
    padding:10px;
    border-radius:6px;
    border:1px solid #ccc;
    outline:none;
}

input:focus {
    border-color:#14b8a6;
    box-shadow:0 0 5px rgba(20,184,166,0.4);
}

button {
    width:100%;
    padding:11px;
    border:none;
    border-radius:6px;
    background:#14b8a6;
    color:#fff;
    font-size:15px;
    cursor:pointer;
    transition:0.3s;
}

button:hover {
    background:#0f766e;
}

#otpBox {
    display:none;
}

#otp{
    margin-top:10px;
}
#resendBtn{
    margin-top:10px;
    background:#14b8a6;
    cursor:pointer;
}

#resendBtn:hover{
    background:#0f766e;
    
}
</style>
</head>
<body>
<div class="container">
    <h3>Forgot Password</h3>

    <div class="input-group">
        <input type="text" id="contact" placeholder="Enter Email or Phone">
    </div>
    <button onclick="sendOtp()">Send OTP</button>

    <div id="otpBox">
        <div class="input-group">
            <input type="text" id="otp" placeholder="Enter OTP">
        </div>
        <button onclick="verifyOtp()">Verify OTP</button>

        <button id="resendBtn" onclick="sendOtp()" disabled>Resend OTP</button>
    </div>
</div>
<script>
  // Store OTP and default contact
let generatedOtp = null;
let defaultContact = "jay13981398@gmail.com"; // Change email here easily

async function sendOtp(){
    const contact = document.getElementById("contact").value.trim();
    if(!contact){
        alert("Please enter email or phone");
        return;
    }

    // Call backend API to check contact in admins first, then users
    const res = await fetch("/forgot-password/check", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ contact })
    });

    const data = await res.json();

    if(data.status === "not_found"){
        alert("Email or Phone not found in our records.");
        document.getElementById("contact").value = ""; // Clear input box
        return;
    }

    if(data.status === "found"){
        // Generate 6-digit OTP
        generatedOtp = Math.floor(100000 + Math.random() * 900000); // 100000 to 999999

        // Send OTP via backend API
        await fetch("/forgot-password/send-otp", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contact: contact || defaultContact, otp: generatedOtp })
        });

        alert("OTP sent successfully. Check your email or phone.");

        // Show OTP input box
        document.getElementById("otpBox").style.display = "block";
    }
}

function verifyOtp() {
    const userOtp = document.getElementById("otp").value.trim();

    if(!userOtp){
        alert("Please enter the OTP");
        return;
    }

    if(userOtp == generatedOtp){
        alert("OTP Verified! Now set your new password.");
        const contact = document.getElementById("contact").value.trim();
        // Redirect to reset password page with contact
        window.location.href = `/reset-password?contact=${encodeURIComponent(contact)}`;
    } else {
        document.getElementById("otp").value = "";
        alert("Incorrect OTP. Try again.");
    }
}

function resetPassword() {
    const newPass = document.getElementById("newpass").value.trim();
    const confPass = document.getElementById("confpass").value.trim();

    if(!newPass || !confPass){
        alert("Please enter and confirm your password");
        return;
    }

    if(newPass !== confPass){
        alert("Passwords do not match!");
        return;
    }

    alert("Password reset successfully!"); 
  
}
</script>


</body>
</html>
