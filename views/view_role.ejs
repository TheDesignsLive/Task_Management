<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roles</title>

<style>
/* ===== Body ===== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #3C3A3A;
}

/* ===== Layout ===== */
.layout {
  display: flex;
  min-height: calc(100vh - 60px);
}

.sidebar-container {
  width: 55px;
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 10px;
  background-color: #f4f4f4;
}

/* ===== Sub Header ===== */
.sub-header {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  margin-left: 26px;
  margin-right: 70px;
}

.sub-header input[type="text"] {
  flex: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 100px;
}

.sub-header button {
  padding: 13px 18px;
  border: none;
  cursor: pointer;
  background-color: #209595;
  color: white;
  border-radius: 100px;
  font-weight: bold;
  margin-top: 30px;
}

/* ===== Table ===== */
table {
  margin-left: 50px;
  width: 90%;
  border-collapse: collapse;
  margin-top: 10px;
  background-color: white;
}

table th, table td {
  padding: 10px;
  border: 1px solid #ccc;
  text-align: center;
}

table th {
  background-color: #CDF4F4;
}

.no-records {
  margin-top: 20px;
  text-align: center;
  color: #555;
}

#searchRole {
  margin-top: 30px;
  max-width: 400px;
  margin-left: 30px;
}

/* ===== Dialog Overlay ===== */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

/* ===== Dialog Box ===== */
.dialog-box {
  background: #fff;
  width: 380px;
  padding: 25px;
  border-radius: 8px;
  position: relative;
}

/* Inputs */
.dialog-box input,
.dialog-box select {
  width: 100%;
  padding: 8px;
  margin-bottom: 12px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

/* Button */
.dialog-box button {
  width: 100%;
  padding: 10px;
  background: #209595;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

/* Close Button */
.close-btn {
  position: absolute;
  top: 6px;
  right: 10px;
  font-size: 20px;
  cursor: pointer;
  font-weight: bold;
}

.close-btn:hover {
  color: red;
}

/* ===== Action Icons ===== */
.actions-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

.action-icon {
  cursor: pointer;
  display: inline-flex;
  align-items: center;
}

.edit-icon svg { fill: #FFD000; }
.delete-icon svg { fill: #ed1e1e; }

</style>
</head>

<body>

<%- include('navbar') %>

<div class="layout">

  <div class="sidebar-container">
    <% if (show_sidebar === 'sidebar') { %>
      <%- include('sidebar') %>
    <% } else { %>
      <%- include('user_sidebar') %>
    <% } %>
  </div>

  <div class="main-content">

    <div class="sub-header">
      <input type="text" placeholder="Search role..." id="searchRole">

      <button onclick="openCategoryDialog()">Add Role</button>
      <button onclick="location.href='/view_member'">View Members</button>
    </div>

    <% if (roles && roles.length > 0) { %>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Role Name</th>
            <th>Control Type</th>
            <th>Manage Members</th>
            <th>Created</th>
            <th>Actions</th> <!-- ADDED -->
          </tr>
        </thead>

        <tbody>
          <% roles.forEach(r => { %>
          <tr>
            <td><%= r.id %></td>
            <td><%= r.role_name %></td>
            <td><%= r.control_type %></td>
            <td><%= r.can_manage_members ? 'YES' : 'NO' %></td>
            <td><%= r.created_at %></td>

            <!-- ACTION COLUMN ADDED -->
            <td>
              <div class="actions-container">

                <a href="javascript:void(0)" 
   onclick="openEditDialog('<%= r.id %>','<%= r.role_name %>','<%= r.control_type %>','<%= r.can_manage_members %>')" 
   class="action-icon edit-icon">
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
                  </svg>
                </a>

                <a href="/delete-role/<%= r.id %>" class="action-icon delete-icon">
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                </a>

              </div>
            </td>

          </tr>
          <% }) %>
        </tbody>
      </table>

    <% } else { %>
      <div class="no-records">No roles found</div>
    <% } %>

  </div>
</div>

<!-- ===== ADD ROLE DIALOG ===== -->
<div class="dialog-overlay" id="categoryDialog">
  <div class="dialog-box">
    <span class="close-btn" onclick="closeCategoryDialog()">✖</span>

    <form action="/add-role" method="POST">

      <label>Role Name</label>
      <input type="text" name="role_name" placeholder="Enter role name" required>

      <div style="display:flex; align-items:center; justify-content:space-between;">
        <label>Can Manage Members</label>
        <input type="checkbox" name="can_manage_members" value="1" style="width:18px; height:18px;">
      </div>

      <select name="control_type" required>
        <option value="">Select Control Type</option>
        <option value="ADMIN">ADMIN</option>
        <option value="PARTIAL">PARTIAL</option>
        <option value="NONE">NONE</option>
      </select>

      <button type="submit">Create Role</button>
    </form>
  </div>
</div>
<!-- ===== EDIT ROLE DIALOG ===== -->
<div class="dialog-overlay" id="editRoleDialog">
  <div class="dialog-box">
    <span class="close-btn" onclick="closeEditDialog()">✖</span>

    <form  id="editRoleForm" method="POST">

      <label>Role Name</label>
      <input type="text" name="role_name" id="edit_role_name" required>

      <div style="display:flex; align-items:center; justify-content:space-between;">
        <label>Can Manage Members</label>
        <input type="checkbox" name="can_manage_members" value="1" id="edit_can_manage">
      </div>

      <select name="control_type" id="edit_control_type" required>
        <option value="ADMIN">ADMIN</option>
        <option value="PARTIAL">PARTIAL</option>
        <option value="NONE">NONE</option>
      </select>

      <button type="submit">Update Role</button>
    </form>
  </div>
</div>


<script>
function openCategoryDialog() {
  document.getElementById("categoryDialog").style.display = "flex";
}
function closeCategoryDialog() {
  document.getElementById("categoryDialog").style.display = "none";
}

function openEditDialog(id, name, control, canManage) {
  document.getElementById("editRoleDialog").style.display = "flex";

  document.getElementById("edit_role_name").value = name;
  document.getElementById("edit_control_type").value = control;
  document.getElementById("edit_can_manage").checked = (canManage == 1);

  document.getElementById("editRoleForm").action = "/edit-role/" + id;
}

function closeEditDialog() {
  document.getElementById("editRoleDialog").style.display = "none";
}

</script>

</body>
</html>
