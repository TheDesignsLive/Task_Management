<style>
:root{
  --teal1:#0f9d9a;
  --teal2:#1bb3a9;
  --light:#e9f2ef;
  --white:#ffffff;
  --border:#d6e3df;
}

body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:#f4f6f5;
}

.navbar{
  display:flex;
  align-items:center;
  gap:15px;
  padding:10px 16px;
  background:linear-gradient(to right,var(--teal1),var(--teal2));
  box-shadow:0 2px 4px rgba(0,0,0,0.1);
}

.logo{
  width:38px;
  height:38px;
  border-radius:50%;
  background:#0b6e6b;
}

.input-box{
  flex:1;
  background:var(--light);
  background-color:#fff;
  border-radius:20px;
  padding:6px 14px;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  max-width:900px;
  height:28px;
}

textarea{
  width:100%;
  border:none;
  resize:none;
  outline:none;
  background:transparent;
  font-size:14px;
  padding:6px 0;
  height:22px;
  overflow:hidden;
  margin-top:4px;
}

.icon-btn{
  background:var(--white);
  border:1px solid var(--border);
  border-radius:6px;
  padding:6px 8px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

select{
  background:var(--white);
  border:1px solid var(--border);
  border-radius:16px;
  padding:6px 10px;
  cursor:pointer;
  font-size:13px;
}

.flag-red{ color:red; }
.flag-green{ color:green; }
.flag-blue{ color:blue; }

.calendar-wrapper{
  position:relative;
  display:inline-block;
  margin-right:10px;
}

#flag{ margin-right:10px; }

.input-box select:last-child{
  margin-right:0;
}

/* user/admin name*/
.navbar {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    background: #14b8a6; /* teal color */
}

.navbar .logo {
    margin-right: 15px;
}

.navbar .input-box {
    flex: 1;
    display: flex;
    align-items: center;
}

.navbar .user-display {
    margin-left: auto; /* pushes it to right */
    font-weight: bold;
    color: #fff;
    font-size: 14px;
}

</style>


<div class="navbar">
  
  <div class="logo">
    <img src="" alt="">
  </div>

  <div class="input-box">
    
    <!-- <textarea id="taskInput" placeholder="Add Task here"></textarea> -->
<textarea id="taskInput" placeholder="Add Task here" style="padding-left:3.5px;"></textarea>

    <div class="calendar-wrapper">
      <button class="icon-btn" onclick="openDate()">ðŸ“…</button>
      <input 
        type="date" 
        id="datePicker"
        style="position:absolute; top:16px; left:-90px; opacity:0; width:28px; height:28px;"
      >
    </div>

    <select id="flag">
      <option class="flag-red">RED</option>
      <option class="flag-green">YELLOW</option>
      <option class="flag-blue">BLUE</option>
    </select>

  <select id="member">

  <!-- Myself -->
  <option value="<%= session.userId || session.adminId %>">
    My Self
  </option>

  <!-- Show Admin Name if User Login -->
  <% if (session.role === "user" && adminName) { %>
    <option value="admin">
      <%= adminName %> (Admin)
    </option>
  <% } %>

  <!-- Members -->
  <% if (members && members.length > 0) { %>
    <% members.forEach(member => { %>
      <option value="<%= member.id %>">
        <%= member.name %>
      </option>
    <% }) %>
  <% } %>

</select>


  </div>
    <!-- Right side user/admin display -->
  <div class="user-display" style="margin-left:auto; font-weight:bold; color:#fff; font-size:14px;">



Welcome <%= (typeof session !== "undefined" && (session.userName || session.adminName)) ? (session.userName || session.adminName) : "Guest" %>
</div>
  </div>
</div>




<script>
const textarea = document.getElementById("taskInput");

textarea.addEventListener("keydown", function(e){
  if(e.key === "Enter" && !e.shiftKey){
    e.preventDefault();

    const fullText = this.value.trim();
    if(!fullText){
      alert("Task cannot be empty!");
      return;
    }

    // Split first line as title, rest as description
    const lines = fullText.split(/\r?\n/);
    const title = lines[0];
    const description = lines.slice(1).join('\n');

    const date = document.getElementById("datePicker").value;
    const priority = document.getElementById("flag").value;
    const assignedTo = document.getElementById("member").value;

    fetch('/add-task', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, description, date, priority, assignedTo })
    })
    .then(res => res.text())
    .then(msg => {
      // ===== AUTO REFRESH PAGE AFTER SUCCESS =====
      window.location.reload();
    })
    .catch(err => console.error(err));

    // Clear input immediately
    textarea.value = '';
    document.getElementById("datePicker").value = '';
  }
});

function openDate(){
  document.getElementById("datePicker").showPicker();
}
</script>